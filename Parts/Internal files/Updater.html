<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3RR0R GAM3S Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Arial,sans-serif;background:black;color:white;height:100vh;display:flex;}
.sidebar{width:250px;background:#111;height:100vh;padding:10px;display:flex;flex-direction:column;gap:10px;overflow-y:auto;}
.main-content{flex:1;padding:20px;border-left:5px solid white;overflow:auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;height:100vh;}
.search-bar input{width:100%;padding:8px 10px;font-size:14px;border-radius:5px;border:2px solid white;background:black;color:white;}
.sidebar button{width:100%;padding:10px;background:black;color:white;border:2px solid white;cursor:pointer;text-align:left;border-radius:3px;transition:0.2s;}
.sidebar button:hover{background:#222;}
.main-content button{width:100%;aspect-ratio:1/1;border:none;background:#111;cursor:pointer;transition: transform 0.2s;display:flex;align-items:center;justify-content:center;text-align:center;border-radius:5px;overflow:hidden;flex-direction:column;}
.main-content button:hover{transform: scale(1.05);}
.main-content button img{width:100%;height:80%;object-fit:cover;border-radius:5px;margin-bottom:5px;}
.overlay{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.95);z-index:100;}
.overlay-content{position:relative;width:100%;height:100%;overflow:auto;}
.overlay-content iframe{width:100%;height:100%;border:none;}
.close-btn{position: fixed; top:20px; right:20px; font-size:50px; color:red; font-weight:bold; cursor:pointer; z-index:101; user-select:none;}
</style>
</head>
<body>

<div class="sidebar">
  <div class="search-bar">
    <input type="text" placeholder="Search..." id="searchInput">
  </div>
  <div class="sidebar-buttons"></div>
</div>

<main class="main-content" id="mainContent"></main>

<div class="overlay">
  <div class="overlay-content">
    <iframe class="content-frame"></iframe>
  </div>
  <span class="close-btn">&times;</span>
</div>

<script>
// ------------------ Repos ------------------
const mainRepo = {owner:"NOTAHACKER9999", repo:"3RR0R-GAM3S", path:"Parts/Unblock websites/Sites runners"};
const sidebarRepo = {owner:"NOTAHACKER9999", repo:"SCHOOL-OVERRIDE", path:"School Override/Parts/Games"};

// DOM Elements
const mainContent = document.getElementById("mainContent");
const sidebarButtonsContainer = document.querySelector(".sidebar-buttons");
const overlay = document.querySelector(".overlay");
const iframe = overlay.querySelector(".content-frame");
const closeBtn = overlay.querySelector(".close-btn");
const searchInput = document.getElementById("searchInput");

// ------------------ Helpers ------------------
function getThumbnail(html, rawUrl){
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = html;
  const imgTag = tempDiv.querySelector('img');
  if(imgTag){
    let src = imgTag.getAttribute('src');
    if(!src.startsWith('http')){
      const base = rawUrl.split('/').slice(0,-1).join('/');
      return base + '/' + src.replace('./','');
    }
    return src;
  }
  const iconTag = tempDiv.querySelector('link[rel="icon"]');
  if(iconTag){
    let href = iconTag.getAttribute('href');
    if(!href.startsWith('http')){
      const base = rawUrl.split('/').slice(0,-1).join('/');
      return base + '/' + href.replace('./','');
    }
    return href;
  }
  return null;
}

// ------------------ Fetch GitHub API ------------------
async function fetchFiles(owner, repo, path){
  const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
  const res = await fetch(apiUrl);
  if(!res.ok){ console.error(`GitHub API error ${res.status}`); return []; }
  return await res.json();
}

// ------------------ Load Main Area ------------------
async function loadMainArea(){
  const files = await fetchFiles(mainRepo.owner, mainRepo.repo, mainRepo.path);
  const htmlFiles = files.filter(f=>f.name.endsWith('.html'));

  for(const file of htmlFiles){
    try{
      const rawUrl = file.download_url;
      const html = await fetch(rawUrl).then(r=>r.text());
      const thumbnail = getThumbnail(html, rawUrl);

      const btn = document.createElement("button");
      if(thumbnail){
        const img = document.createElement("img");
        img.src = thumbnail;
        btn.appendChild(img);
      }
      const text = document.createElement("span");
      text.textContent = file.name.replace(".html","");
      btn.appendChild(text);

      // Inject HTML into iframe when clicked
      btn.addEventListener("click", async ()=>{
        const htmlContent = await fetch(rawUrl).then(r=>r.text());
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.open();
        doc.write(htmlContent);
        doc.close();
        overlay.style.display = "block";
      });

      mainContent.appendChild(btn);
    }catch(err){ console.error("Main area file error:", file.name, err); }
  }
}

// ------------------ Load Sidebar ------------------
async function loadSidebar(){
  const files = await fetchFiles(sidebarRepo.owner, sidebarRepo.repo, sidebarRepo.path);
  const htmlFiles = files.filter(f=>f.name.endsWith('.html'));

  for(const file of htmlFiles){
    try{
      const rawUrl = file.download_url;
      const button = document.createElement("button");
      button.textContent = file.name.replace(".html","");
      button.addEventListener("click", async ()=>{
        const htmlContent = await fetch(rawUrl).then(r=>r.text());
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.open();
        doc.write(htmlContent);
        doc.close();
        overlay.style.display = "block";
      });
      sidebarButtonsContainer.appendChild(button);
    }catch(err){ console.error("Sidebar file error:", file.name, err); }
  }
}

// ------------------ Search ------------------
searchInput.addEventListener("input", ()=>{
  const query = searchInput.value.toLowerCase();
  const buttons = sidebarButtonsContainer.querySelectorAll("button");
  buttons.forEach(btn=>{
    btn.style.display = btn.textContent.toLowerCase().includes(query) ? "block" : "none";
  });
});

// ------------------ Overlay ------------------
closeBtn.addEventListener("click", ()=>{ overlay.style.display="none"; iframe.src="about:blank"; });
overlay.addEventListener("click", e=>{ if(e.target===overlay){ overlay.style.display="none"; iframe.src="about:blank"; } });

// ------------------ Initialize ------------------
loadMainArea();
loadSidebar();
</script>
</body>
</html>
